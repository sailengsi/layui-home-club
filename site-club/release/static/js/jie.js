layui.define(["laypage","fly"],function(a){var t=layui.jquery,i=layui.layer,e=(layui.util,layui.laytpl),n=(layui.form,layui.laypage,layui.fly),d={},o={jieda:t("#jieda"),content:t("#L_content"),jiedaCount:t("#jiedaCount")};n.form["/jie/reply/"]=function(a,i){var d='<li>      <div class="detail-about detail-about-reply">        <a class="jie-user" href="/user/">          <img src="{{= d.user.avatar}}" alt="{{= d.user.username}}">          <cite>{{d.user.username}}</cite>        </a>        <div class="detail-hits">          <span>刚刚</span>        </div>      </div>      <div class="detail-body jieda-body">        {{ d.content}}      </div>    </li>';a.content=n.content(a.content),e(d).render(t.extend(a,{user:layui.cache.user}),function(a){i[0].value="",o.jieda.find(".fly-none").remove(),o.jieda.append(a);var t=0|o.jiedaCount.text();o.jiedaCount.html(++t)})},d.jieAdmin={del:function(a){i.confirm("确认删除该求解么？",function(t){i.close(t),n.json("/api/jie-delete/",{id:a.data("id")},function(a){0===a.status?location.href="/jie/":i.msg(a.msg)})})},set:function(a){var i=t(this);n.json("/api/jie-set/",{id:a.data("id"),rank:i.attr("rank"),field:i.attr("field")},function(a){0===a.status&&location.reload()})},collect:function(a){var i=t(this),e=i.data("type");n.json("/collection/"+e+"/",{cid:a.data("id")},function(){"add"===e?i.data("type","remove").html("取消收藏").addClass("layui-btn-danger"):"remove"===e&&i.data("type","add").html("收藏").removeClass("layui-btn-danger")})}},t("body").on("click",".jie-admin",function(){var a=t(this),i=a.attr("type");d.jieAdmin[i].call(this,a.parent())});!function(){var a=t(".fly-detail-hint"),i=t("#LAY_jieAdmin");i[0]&&-1!=layui.cache.user.uid&&n.json("/collection/find/",{cid:a.data("id")},function(a){i.append('<span class="layui-btn layui-btn-mini jie-admin '+(a.data.collection?"layui-btn-danger":"")+'" type="collect" data-type="'+(a.data.collection?"remove":"add")+'">'+(a.data.collection?"取消收藏":"收藏")+"</span>")})}();d.jiedaActive={zan:function(a){var e=t(this),d=e.hasClass("zanok");n.json("/api/jieda-zan/",{ok:d,id:a.data("id")},function(a){if(0===a.status){var t=0|e.find("em").html();e[d?"removeClass":"addClass"]("zanok"),e.find("em").html(d?--t:++t)}else i.msg(a.msg)})},reply:function(a){var t=o.content.val(),i="@"+a.find(".jie-user cite i").text().replace(/\s/g,"");o.content.focus(),-1===t.indexOf(i)&&o.content.val(i+" "+t)},accept:function(a){t(this);i.confirm("是否采纳该回答为最佳答案？",function(e){i.close(e),n.json("/api/jieda-accept/",{id:a.data("id")},function(e){0===e.status?(t(".jieda-accept").remove(),a.addClass("jieda-daan"),a.find(".detail-about").append('<i class="iconfont icon-caina" title="最佳答案"></i>')):i.msg(e.msg)})})},edit:function(a){n.json("/jie/getDa/",{id:a.data("id")},function(t){var e=t.rows;i.prompt({formType:2,value:e.content,maxlength:1e5},function(t,e){n.json("/jie/updateDa/",{id:a.data("id"),content:t},function(){i.close(e),a.find(".detail-body").html(n.content(t))})})})},del:function(a){i.confirm("确认删除该回答么？",function(e){i.close(e),n.json("/api/jieda-delete/",{id:a.data("id")},function(e){if(0===e.status){var n=0|o.jiedaCount.text();o.jiedaCount.html(--n),a.remove(),a.hasClass("jieda-daan")&&t(".jie-status").removeClass("jie-status-ok").text("求解中")}else i.msg(e.msg)})})}},t(".jieda-reply span").on("click",function(){var a=t(this),i=a.attr("type");d.jiedaActive[i].call(this,a.parents("li"))}),a("jie",null)});